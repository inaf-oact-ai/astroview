@page "/Datasets/{DatasetId:int}/OutlierFinder"
@inherits AppPageBase
<PageTitle>Outlier Finder</PageTitle>
<Breadcrumbs PageName="DatasetFunctionOutlierFinder" DatasetName="@vm.DatasetName" DatasetId="@DatasetId"></Breadcrumbs>

<div class="page-header">
    <span class="page-header-title">Outlier Finder</span>
    <DisplayModeSelector DatasetId="DatasetId" OnDisplayModeChanged="OnDisplayModeChanged" />
</div>

@if (vm.ExecuteDisabled)
{
    <div class="ui negative message">
        <p>Caesar Dataset must be generated for Display Mode: @vm.SelectedDisplayMode?.Name</p>
    </div>
}

<div class="ui four column grid">
    <div class="row">
        <div class="column">
            <h4 class="ui dividing header">Input</h4>
            <div class="ui form">
                <div class="field">
                    <label>Data column ids to be selected from input data, separated by commas</label>
                    <InputText @bind-Value="vm.Parameters.SelCols"></InputText>
                </div>
                <div class="field">
                    <label>Dictionary key name to be read in input datalist</label>
                    <InputText disabled @bind-Value="vm.Parameters.DatalistKey"></InputText>
                </div>
            </div>
            <h4 class="ui dividing header">Pre-processing</h4>
            <div class="ui form">
                <div class="field">
                    <div class="ui checkbox">
                        <InputCheckbox id="NormalizeMinMax" @bind-Value="vm.Parameters.NormalizeMinMax"></InputCheckbox>
                        <label for="NormalizeMinMax">Normalize each channel in range</label>
                    </div>
                </div>
            </div>
        </div>
        <div class="column">
            <h4 class="ui dividing header">Processing</h4>
            <div class="ui form">
                <div class="field">
                    <label>Threshold in anomaly score above which observation is set as outlier</label>
                    <InputNumber @bind-Value="vm.Parameters.AnomalyThr"></InputNumber>
                </div>
                <div class="field">
                    <label>Fraction of outliers expected [0,0.5]. If less than 0 will set it to auto</label>
                    <InputNumber @bind-Value="vm.Parameters.Contamination"></InputNumber>
                </div>
                <div class="field">
                    <label>Number of max features used in each forest tree</label>
                    <InputNumber @bind-Value="vm.Parameters.MaxFeatures"></InputNumber>
                </div>
                <div class="field">
                    <label>Number of max samples used in each forest tree. -1 means auto options, e.g. 256 entries, otherwise it is the fraction of total available entries</label>
                    <InputNumber @bind-Value="vm.Parameters.MaxSamples"></InputNumber>
                </div>
                <div class="field">
                    <label>Number of forest trees to fit</label>
                    <InputNumber @bind-Value="vm.Parameters.Nestimators"></InputNumber>
                </div>
            </div>
        </div>
        <div class="column">
            <h4 class="ui dividing header">Run</h4>
            <div class="ui form">
                <div class="field">
                    <div class="ui checkbox">
                        <InputCheckbox id="noLogRedir" @bind-Value="vm.Parameters.NoLogRedir"></InputCheckbox>
                        <label for="noLogRedir">Do not redirect logs to output file in script</label>
                    </div>
                </div>
            </div>
        </div>
        <div class="column">
            <h4 class="ui dividing header">Output</h4>
            <div class="ui form">
                <div class="field">
                    <div class="ui checkbox">
                        <InputCheckbox id="NoSaveAsci" disabled @bind-Value="vm.Parameters.NoSaveAsci"></InputCheckbox>
                        <label for="NoSaveAsci">Do not save output in ascii format</label>
                    </div>
                </div>
                <div class="field">
                    <div class="ui checkbox">
                        <InputCheckbox id="NoSaveJson" disabled @bind-Value="vm.Parameters.NoSaveJson"></InputCheckbox>
                        <label for="NoSaveJson">Do not save output in json format</label>
                    </div>
                </div>
                <div class="field">
                    <div class="ui checkbox">
                        <InputCheckbox id="NoSaveModel" disabled @bind-Value="vm.Parameters.NoSaveModel"></InputCheckbox>
                        <label for="NoSaveModel">Do not save model</label>
                    </div>
                </div>
                <div class="field">
                    <div class="ui checkbox">
                        <InputCheckbox id="NoSaveFeatures" disabled @bind-Value="vm.Parameters.NoSaveFeatures"></InputCheckbox>
                        <label for="NoSaveFeatures">Do not save features</label>
                    </div>
                </div>
                <div class="field">
                    <label>Name of output file in ascii format</label>
                    <InputText disabled @bind-Value="vm.Parameters.Outfile"></InputText>
                </div>
                <div class="field">
                    <label>Name of output file in json format</label>
                    <InputText disabled @bind-Value="vm.Parameters.OutfileJson"></InputText>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="four wide column">
            <button class="ui compact primary button @(vm.ShowExecuteLoader ? "loading" : "")" disabled=@vm.ExecuteDisabled @onclick="Execute">Execute</button>
            <button class="ui compact button @(vm.ShowLoadDescriptionLoader ? "loading" : "")" @onclick="LoadDescription">Load Description</button>
        </div>
    </div>
    @if (vm.Description.Length > 0)
    {
        <div class="row">
            <div class="sixteen wide column">
                <div class="ui message">
                    <pre>@((MarkupString)vm.Description)</pre>
                </div>
            </div>
        </div>
    }
</div>